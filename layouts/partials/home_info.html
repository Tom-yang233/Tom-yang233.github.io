{{- with site.Params.homeInfoParams }}
<article class="first-entry home-info"
  {{- if .heroBg }} style="background-image:url('{{ .heroBg }}')" {{- end }}>
    {{- if .heroBg }}<div class="home-hero-overlay"></div>{{- end }}
    {{- if .avatar }}
    <img src="{{ .avatar }}" alt="avatar" class="home-avatar" />
    {{- end }}
    <header class="entry-header">
        <h1>{{ .Title | markdownify }}</h1>
    </header>
    <div class="entry-content">
        {{ .Content | markdownify }}
    </div>
    <footer class="entry-footer">
        {{ partial "social_icons.html" (dict "align" site.Params.homeInfoParams.AlignSocialIconsTo) }}
    </footer>
</article>
{{- end -}}

{{/* 最近文章滚动 ticker */}}
{{- $allPosts := where site.RegularPages "Section" "posts" }}
{{- $allPosts = where $allPosts "Params.hiddenInHomeList" "!=" "true" }}
{{- $recentPosts := first 12 $allPosts }}
{{- if $recentPosts }}
<div class="home-ticker-wrap">
  <span class="home-ticker-label">最近更新</span>
  <div class="home-ticker-v" id="home-ticker-v">
    {{- range $index, $p := $recentPosts }}
    <a href="{{ $p.RelPermalink }}" class="home-ticker-v-item{{if eq $index 0}} active{{end}}">{{ $p.Title }}</a>
    {{- end }}
  </div>
</div>
{{- end }}

{{/* 底部工具栏：文章总数 + 随机文章 */}}
<div class="home-meta-bar">
  <span class="home-post-count">共 {{ len $allPosts }} 篇文章</span>
  <a id="home-random-btn" class="home-random-btn" href="#" title="随机跳转到一篇文章">随机一篇 →</a>
</div>

<script>
(function () {
  /* 随机文章 */
  var posts = [
    {{- range $allPosts }}
    {{ .RelPermalink | jsonify }},
    {{- end }}
  ];
  var btn = document.getElementById('home-random-btn');
  if (btn && posts.length > 0) {
    btn.addEventListener('click', function (e) {
      e.preventDefault();
      window.location.href = posts[Math.floor(Math.random() * posts.length)];
    });
  }

  /* 上下切换 ticker */
  var items = document.querySelectorAll('#home-ticker-v .home-ticker-v-item');
  if (items.length < 2) return;
  var cur = 0;
  var dur = 380; // 动画时长 ms

  function step() {
    var leaving = items[cur];
    cur = (cur + 1) % items.length;
    var entering = items[cur];

    /* 当前条目滑出（向上） */
    leaving.style.transition = 'transform ' + dur + 'ms ease, opacity ' + dur + 'ms ease';
    leaving.style.transform = 'translateY(-110%)';
    leaving.style.opacity = '0';

    /* 准备新条目从下方就位（无动画） */
    entering.style.transition = 'none';
    entering.style.transform = 'translateY(110%)';
    entering.style.opacity = '0';
    entering.style.display = 'block';
    entering.offsetHeight; /* 强制 reflow */

    /* 新条目滑入 */
    entering.style.transition = 'transform ' + dur + 'ms ease, opacity ' + dur + 'ms ease';
    entering.style.transform = 'translateY(0)';
    entering.style.opacity = '1';

    /* 离开条目收起 */
    setTimeout(function () {
      leaving.style.transition = 'none';
      leaving.style.display = 'none';
    }, dur);
  }

  setInterval(step, 3200);
})();
</script>
