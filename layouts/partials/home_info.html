{{- with site.Params.homeInfoParams }}
{{- if .heroBg }}
<div class="home-hero-banner" style="background-image:url('{{ .heroBg }}')">
  <div class="home-hero-overlay"></div>
</div>
{{- end }}
<article class="first-entry home-info{{if .heroBg}} has-hero{{end}}">
    <header class="entry-header">
        {{- if .avatar }}
        <img src="{{ .avatar }}" alt="avatar" class="home-avatar" />
        {{- end }}
        <h1>{{ .Title | markdownify }}</h1>
    </header>
    {{/* æ—¶è¾°é—®å€™è¯­ */}}
    <div class="home-greeting" id="home-greeting"></div>
    <div class="entry-content">
        <span id="home-typewriter"></span><span class="typewriter-cursor">|</span>
    </div>
    <footer class="entry-footer">
        {{ partial "social_icons.html" (dict "align" site.Params.homeInfoParams.AlignSocialIconsTo) }}
    </footer>

    {{/* é‡ç”Ÿå°è¯— */}}
    <div class="home-poem" id="home-poem">
      <div class="home-poem-title">é‡ç”Ÿå°è¯—</div>
      <div class="home-poem-content" id="home-poem-content"></div>
      <div class="home-poem-origin" id="home-poem-origin"></div>
    </div>
</article>
{{- end -}}

{{/* æœ€è¿‘æ–‡ç« æ»šåŠ¨ ticker */}}
{{- $allPosts := where site.RegularPages "Section" "posts" }}
{{- $allPosts = where $allPosts "Params.hiddenInHomeList" "!=" "true" }}
{{- $recentPosts := first 12 $allPosts }}
{{- if $recentPosts }}
<div class="home-ticker-wrap">
  <span class="home-ticker-label">æœ€è¿‘æ›´æ–°</span>
  <div class="home-ticker-v" id="home-ticker-v">
    {{- range $index, $p := $recentPosts }}
    <a href="{{ $p.RelPermalink }}" class="home-ticker-v-item{{if eq $index 0}} active{{end}}">{{ $p.Title }}</a>
    {{- end }}
  </div>
</div>
{{- end }}

{{/* åº•éƒ¨å·¥å…·æ ï¼šæ–‡ç« æ€»æ•° + ç«™ç‚¹è¿è¡Œæ—¶é—´ + éšæœºæ–‡ç«  */}}
<div class="home-meta-bar">
  <span class="home-post-count">å…± {{ len $allPosts }} ç¯‡æ–‡ç« </span>
  <span class="home-uptime" id="home-uptime" title="ç«™ç‚¹å·²è¿è¡Œæ—¶é—´"></span>
  <a id="home-random-btn" class="home-random-btn" href="#" title="éšæœºè·³è½¬åˆ°ä¸€ç¯‡æ–‡ç« ">éšæœºä¸€ç¯‡ â†’</a>
</div>

<script>
(function () {
  /* ====== æ‰“å­—æœºæ•ˆæœ ====== */
  var fullText = "{{ site.Params.homeInfoParams.Content | plainify | safeJS }}";
  var typeEl = document.getElementById('home-typewriter');
  if (typeEl && fullText) {
    var chars = Array.from(fullText);
    var i = 0;
    function typeNext() {
      if (i < chars.length) {
        typeEl.textContent += chars[i];
        i++;
        setTimeout(typeNext, 90 + Math.random() * 60);
      }
    }
    setTimeout(typeNext, 600);
  }

  /* ====== æ—¶è¾°é—®å€™è¯­ ====== */
  var greetEl = document.getElementById('home-greeting');
  if (greetEl) {
    var h = new Date().getHours();
    var greetings = [
      [5,  8,  'ğŸŒ… æ™¨èµ·å¥½è¯»ä¹¦'],
      [8,  11, 'â˜€ï¸ ä¸Šåˆå¥½ï¼Œæ–°çš„ä¸€å¤©'],
      [11, 13, 'ğŸš åˆå®‰ï¼Œè®°å¾—åƒé¥­'],
      [13, 17, 'ğŸµ ä¸‹åˆå®œå“èŒ—'],
      [17, 19, 'ğŸŒ‡ é»„æ˜å¥½æ•£æ­¥'],
      [19, 22, 'ğŸŒ™ å¤œæ·±å®œé™æ€'],
      [22, 24, 'ğŸŒŒ å¤œå·²æ·±ï¼Œæ—©äº›ä¼‘æ¯'],
      [0,  5,  'ğŸ’¤ å‡Œæ™¨äº†ï¼Œè¿˜æ²¡ç¡ï¼Ÿ']
    ];
    for (var g = 0; g < greetings.length; g++) {
      if (h >= greetings[g][0] && h < greetings[g][1]) {
        greetEl.textContent = greetings[g][2];
        break;
      }
    }
  }

  /* ====== é‡ç”Ÿå°è¯—ï¼ˆæœ¬åœ°è¯—è¯åº“ï¼‰====== */
  var poems = {{ site.Data.poems | jsonify | safeJS }};
  var poemEl = document.getElementById('home-poem-content');
  var originEl = document.getElementById('home-poem-origin');
  if (poemEl && poems.length > 0) {
    var p = poems[Math.floor(Math.random() * poems.length)];
    poemEl.textContent = 'ã€Œ' + p.content + 'ã€';
    if (p.author && p.origin) {
      originEl.textContent = 'â€”â€” ' + p.author + 'ã€Š' + p.origin + 'ã€‹';
    }
    document.getElementById('home-poem').style.opacity = '1';
  }

  /* ====== ç«™ç‚¹è¿è¡Œæ—¶é—´ ====== */
  var uptimeEl = document.getElementById('home-uptime');
  if (uptimeEl) {
    var startDate = new Date('2025-01-01T00:00:00');
    function updateUptime() {
      var now = new Date();
      var diff = now - startDate;
      var days = Math.floor(diff / 86400000);
      var hours = Math.floor((diff % 86400000) / 3600000);
      var mins = Math.floor((diff % 3600000) / 60000);
      uptimeEl.textContent = 'å·²è¿è¡Œ ' + days + ' å¤© ' + hours + ' æ—¶ ' + mins + ' åˆ†';
    }
    updateUptime();
    setInterval(updateUptime, 60000);
  }

  /* ====== éšæœºæ–‡ç«  ====== */
  var posts = [
    {{- range $allPosts }}
    "{{ .RelPermalink }}",
    {{- end }}
  ];
  var btn = document.getElementById('home-random-btn');
  if (btn && posts.length > 0) {
    btn.addEventListener('click', function (e) {
      e.preventDefault();
      window.location.href = posts[Math.floor(Math.random() * posts.length)];
    });
  }

  /* ====== ä¸Šä¸‹åˆ‡æ¢ ticker ====== */
  var items = document.querySelectorAll('#home-ticker-v .home-ticker-v-item');
  if (items.length < 2) return;
  var cur = 0;
  var dur = 380;

  function step() {
    var leaving = items[cur];
    cur = (cur + 1) % items.length;
    var entering = items[cur];

    leaving.style.transition = 'transform ' + dur + 'ms ease, opacity ' + dur + 'ms ease';
    leaving.style.transform = 'translateY(-110%)';
    leaving.style.opacity = '0';

    entering.style.transition = 'none';
    entering.style.transform = 'translateY(110%)';
    entering.style.opacity = '0';
    entering.style.display = 'block';
    entering.offsetHeight;

    entering.style.transition = 'transform ' + dur + 'ms ease, opacity ' + dur + 'ms ease';
    entering.style.transform = 'translateY(0)';
    entering.style.opacity = '1';

    setTimeout(function () {
      leaving.style.transition = 'none';
      leaving.style.display = 'none';
    }, dur);
  }

  setInterval(step, 3200);
})();
</script>
